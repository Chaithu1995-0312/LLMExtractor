# NEXUS RULES AND INVARIANTS

## 1. Graph Invariants
- **Acyclic Enforcement:** Relationships must not form circular logic (e.g., A SUPPORTS B, B SUPPORTS A is disallowed if strictly enforced). Check performed by `_check_for_cycle` in `GraphManager`.
- **Node Immutability:** Once a node is marked as `KILLED`, its attributes and relationships should not be modified.
- **Unique Identification:** Every `node_id` and `brick_id` must be globally unique within the system. Brick IDs are generated using a content-hash + metadata strategy.
- **Reference Integrity:** An Edge cannot exist without a valid `src` and `dst` node in the Graph.

## 2. Ingestion & Sync Rules
- **Idempotency:** Re-running a sync for the same `run_id` must not create duplicate Bricks. This is handled by fingerprinting in `SyncDatabase`.
- **Atomic Runs:** A `compile_run` must either complete fully or roll back its changes (implied transactional boundary).
- **Source Attribution:** Every Brick must have a verifiable link back to its parent `Source` and `Topic`.

## 3. Recall & Governance Rules
- **Scope Isolation:** Results returned by `recall_bricks` MUST be filtered by `allowed_scopes`. A query in a `session` scope cannot see `private` bricks from another session unless explicitly permitted.
- **Truth Anchoring:** Responses generated by the system must provide citations (Brick IDs) for every factual claim.
- **Prompt Governance:** Only prompts approved via `PromptManager` can be used for `Cognition` layer tasks. Direct injection of prompts into LLM calls is a violation.

## 4. Lifecycle Gatekeepers
- **Promotion Flow:** `DRAFT` -> `ACTIVE` -> `FROZEN`.
- **Supersession:** When a node is superseded, the system must maintain a pointer from the old node to the new node to preserve historical audit paths.
- **Audit Requirement:** All write operations to the Graph must be accompanied by an `actor` and a `reason`.

## 5. Cognition Constraints
- **DSPy Signature Adherence:** All cognitive modules must strictly follow their defined `FactSignature` or `RelationshipSignature`.
- **Model Determinism:** While LLMs are stochastic, the `Assembler` should aim for deterministic output by pinning temperature and top-p settings where appropriate.
